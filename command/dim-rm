#!/usr/bin/env bash

dim_rm_command() {
  begin_function

    setup_cell_path_vars $cell_path || fail
    local dims=${dims:-${dim:-}} dim

    if [[ ! "${dims:-}" ]]; then
      log_fatal "dim must be specified"
      fail1
    fi
    
    begin_for dim in $dims; doo

      log_verbose "Removing dim $dim"

      local found_something=f

      if [[ -f $dim_all_path/var/${dim}_description ]]; then
        rm $dim_all_path/var/${dim}_description || fail
        found_something=t
      fi

      if [[ -f $dim_all_path/var/${dim}_examples ]]; then
        rm $dim_all_path/var/${dim}_examples || fail
        found_something=t
      fi

      if [[ -f $dim_all_path/fun/${dim}_member_expand ]]; then
        rm $dim_all_path/fun/${dim}_member_expand || fail
        found_something=t
      fi

      if [[ $found_something == f ]]; then
        log_warn "Dim not found: $dim"
      else
        if [[ -e $var_path/dims ]]; then
          grep -v "$dim" $var_path/dims >$var_path/dims.new || fail
          mv $var_path/dims.new $var_path/dims || fail
        fi
      fi

    end_for

  end_function
  handle_return
}

